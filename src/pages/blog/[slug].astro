---
import Layout from "../../layouts/Layout.astro";
import { getEntry } from "astro:content";
import { Image } from "astro:assets";
import { identity } from "../../config";

const { slug } = Astro.params;
const entry = await getEntry("posts", slug as string);

if (!entry) {
  return Astro.redirect("/blog");
}

const { Content, headings, remarkPluginFrontmatter } = await entry.render();
const pdfUrl = entry.data.pdf;
const imageUrl = entry.data.image?.url ?? "";
const imageAlt = entry.data.image?.alt;
---

<Layout
  seo={{
    title: entry.data.title,
    description: entry.data.description,
    image: imageUrl,
  }}
>
  <section class="mt-10 max-w-2xl mx-auto px-6">
    <h1 class="font-bold text-3xl mb-4">{entry.data.title}</h1>
    <p class="opacity-60 mb-6">
      {entry.data.description}
    </p>
    <div class="flex gap-4 mb-6">
      <Image
        src={identity.logo}
        alt={identity.name}
        width={40}
        height={40}
        class="w-[40px] aspect-square object-cover rounded-full"
      />
      <div>
        <p class="font-medium">{identity.name}</p>
        <p class="opacity-60">
          {entry.data.pubDate.toLocaleDateString()} Â· {
            remarkPluginFrontmatter.minutesRead
          }
        </p>
      </div>
    </div>
    {imageUrl && (
      <Image
        src={imageUrl}
        alt={imageAlt ?? null}
        width={800}
        height={300}
        class="apsect-video w-full rounded-xl mb-10"
      />
    )}
    <article
      class="prose prose-invert prose-a:text-blue-300 prose-a:underline-offset-4 prose-headings:mb-2 prose-p:text-[#b3b3b3]"
    >
      <Content />
    </article>

    {pdfUrl && (
      <div class="pdf-container mt-10">
        <h2 class="font-bold text-2xl mb-4">PDF Document</h2>
        <div class="relative overflow-hidden rounded-lg shadow-lg border border-gray-700 group" style="height: 50vh;">
          <iframe
            src={pdfUrl}
            width="100%"
            height="100%"
            class="border-none"
            style="height: 100%;"
          ></iframe>
          <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-transparent to-black opacity-50 group-hover:opacity-75 transition-opacity"></div>
          <div class="absolute bottom-0 left-0 p-4 text-white opacity-0 group-hover:opacity-100 transition-opacity">
            <p class="text-lg font-semibold">View the PDF document</p>
            <a
              href={pdfUrl}
              target="_blank"
              class="inline-block mt-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition"
            >
              Open in new tab
            </a>
          </div>
        </div>
      </div>
    )}
  </section>
</Layout>